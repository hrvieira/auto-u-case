<!DOCTYPE html>
<html lang="pt-BR">

<head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>AutoU - Classificador de Emails Inteligente</title>
     <script src="https://cdn.tailwindcss.com"></script>
     <link rel="preconnect" href="https://fonts.googleapis.com">
     <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
     <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
     <style>
          body {
               font-family: 'Inter', sans-serif;
          }

          .tab-button.active {
               border-color: #8B5CF6;
               /* violet-500 */
               color: #8B5CF6;
               background-color: #F5F3FF;
               /* violet-50 */
          }

          .tab-panel {
               display: none;
          }

          .tab-panel.active {
               display: block;
          }

          #result-container>div {
               animation: fadeIn 0.5s ease-in-out;
          }

          @keyframes fadeIn {
               from {
                    opacity: 0;
                    transform: translateY(10px);
               }

               to {
                    opacity: 1;
                    transform: translateY(0);
               }
          }
     </style>
</head>

<body class="bg-slate-100 flex items-center justify-center min-h-screen p-4">
     <div class="w-full max-w-2xl mx-auto">
          <div class="bg-white rounded-xl shadow-2xl overflow-hidden">
               <div class="p-8">
                    <div class="flex items-center space-x-4">
                         <div class="bg-violet-100 p-3 rounded-full">
                              <svg class="w-8 h-8 text-violet-600" xmlns="http://www.w3.org/2000/svg" fill="none"
                                   viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                   <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75" />
                              </svg>
                         </div>
                         <div>
                              <h1 class="text-2xl font-bold text-slate-800">Classificador de E-mails</h1>
                              <p class="text-slate-500">Analise e classifique e-mails com um clique.</p>
                         </div>
                    </div>

                    <div class="mt-8">
                         <!-- Abas de Entrada -->
                         <div class="flex border-b border-slate-200">
                              <button id="tab-text"
                                   class="tab-button active flex-1 text-center font-semibold text-slate-500 p-3 border-b-2 border-transparent transition duration-200">
                                   Colar Texto
                              </button>
                              <button id="tab-file"
                                   class="tab-button flex-1 text-center font-semibold text-slate-500 p-3 border-b-2 border-transparent transition duration-200">
                                   Enviar Arquivo
                              </button>
                         </div>

                         <!-- Painéis de Entrada -->
                         <div class="mt-6">
                              <div id="panel-text" class="tab-panel active">
                                   <label for="text" class="block text-sm font-semibold text-slate-700 mb-2">Corpo do
                                        e-mail:</label>
                                   <textarea id="text" placeholder="Cole o conteúdo completo do e-mail aqui..."
                                        class="w-full h-40 p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-violet-500 focus:border-violet-500 transition"></textarea>
                              </div>
                              <div id="panel-file" class="tab-panel">
                                   <label for="file" class="block text-sm font-semibold text-slate-700 mb-2">Arquivo
                                        (.txt, .pdf):</label>
                                   <input id="file" type="file" accept=".txt,.pdf"
                                        class="block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-violet-50 file:text-violet-700 hover:file:bg-violet-100" />
                              </div>
                         </div>
                    </div>

                    <div class="mt-8">
                         <button id="send"
                              class="w-full bg-violet-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-violet-700 focus:outline-none focus:ring-4 focus:ring-violet-300 transition-all duration-300 flex items-center justify-center disabled:bg-slate-400 disabled:cursor-not-allowed">
                              <span id="button-text">Processar</span>
                              <svg id="loading-spinner" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden"
                                   xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                   <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                        stroke-width="4"></circle>
                                   <path class="opacity-75" fill="currentColor"
                                        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                   </path>
                              </svg>
                         </button>
                    </div>
               </div>

               <div id="result-container" class="bg-slate-50 p-8 border-t border-slate-200">
                    <!-- O resultado será inserido aqui -->
               </div>
          </div>
     </div>

     <script>
          const tabText = document.getElementById('tab-text');
          const tabFile = document.getElementById('tab-file');
          const panelText = document.getElementById('panel-text');
          const panelFile = document.getElementById('panel-file');
          const sendButton = document.getElementById('send');
          const resultContainer = document.getElementById('result-container');
          const fileInput = document.getElementById('file');
          const textInput = document.getElementById('text');

          let activeTab = 'text';

          function switchTab(tab) {
               activeTab = tab;
               if (tab === 'text') {
                    tabText.classList.add('active');
                    tabFile.classList.remove('active');
                    panelText.classList.add('active');
                    panelFile.classList.remove('active');
               } else {
                    tabFile.classList.add('active');
                    tabText.classList.remove('active');
                    panelFile.classList.add('active');
                    panelText.classList.remove('active');
               }
          }

          tabText.addEventListener('click', () => switchTab('text'));
          tabFile.addEventListener('click', () => switchTab('file'));

          function showLoading() {
               sendButton.disabled = true;
               document.getElementById('button-text').classList.add('hidden');
               document.getElementById('loading-spinner').classList.remove('hidden');
          }

          function hideLoading() {
               sendButton.disabled = false;
               document.getElementById('button-text').classList.remove('hidden');
               document.getElementById('loading-spinner').classList.add('hidden');
          }

          function displayResult(data) {
               const badgeClass = data.category === 'Produtivo' ? 'bg-blue-100 text-blue-800' : 'bg-amber-100 text-amber-800';
               const confidence = data.confidence ? (data.confidence * 100).toFixed(1) + '%' : 'N/A';

               resultContainer.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white p-4 rounded-lg shadow-sm border border-slate-200">
                        <h3 class="text-sm font-semibold text-slate-500 mb-2">Categoria</h3>
                        <p class="text-lg font-bold ${badgeClass} inline-block px-3 py-1 rounded-full">${data.category}</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-sm border border-slate-200">
                        <h3 class="text-sm font-semibold text-slate-500 mb-2">Nível de Confiança</h3>
                        <p class="text-lg font-bold text-slate-800">${confidence}</p>
                    </div>
                </div>

                <div class="mt-6 bg-white p-4 rounded-lg shadow-sm border border-slate-200">
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="text-sm font-semibold text-slate-500">Resposta Sugerida</h3>
                        <button onclick="copyToClipboard('suggested-response')" class="text-sm text-violet-600 hover:text-violet-800 font-semibold">Copiar</button>
                    </div>
                    <pre id="suggested-response" class="text-sm text-slate-700 bg-slate-50 p-3 rounded-md whitespace-pre-wrap">${data.suggested_response}</pre>
                </div>
                
                <div class="mt-6 bg-white p-4 rounded-lg shadow-sm border border-slate-200">
                    <h3 class="text-sm font-semibold text-slate-500 mb-2">Trecho Pré-processado</h3>
                    <pre class="text-xs text-slate-600 bg-slate-50 p-3 rounded-md whitespace-pre-wrap">${data.preprocessed_excerpt}</pre>
                </div>
            `;
          }

          function displayError(message) {
               resultContainer.innerHTML = `
                <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-md" role="alert">
                    <p class="font-bold">Ocorreu um Erro</p>
                    <p>${message}</p>
                </div>
            `;
          }

          function copyToClipboard(elementId) {
               const textToCopy = document.getElementById(elementId).innerText;
               navigator.clipboard.writeText(textToCopy).then(() => {
                    alert('Resposta copiada!');
               }, (err) => {
                    alert('Erro ao copiar: ', err);
               });
          }

          sendButton.addEventListener('click', async () => {
               showLoading();
               resultContainer.innerHTML = '';

               const form = new FormData();
               if (activeTab === 'file' && fileInput.files.length > 0) {
                    form.append('file', fileInput.files[0]);
               } else if (activeTab === 'text' && textInput.value.trim() !== '') {
                    form.append('text', textInput.value);
               } else {
                    hideLoading();
                    displayError('Por favor, envie um arquivo ou cole um texto para análise.');
                    return;
               }

               try {
                    const response = await fetch('/api/process', { method: 'POST', body: form });

                    if (!response.ok) {
                         const errorData = await response.json().catch(() => ({ detail: 'Erro desconhecido no servidor.' }));
                         throw new Error(errorData.detail || `HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();
                    displayResult(data);

               } catch (err) {
                    console.error('Fetch Error:', err);
                    displayError(err.message || 'Não foi possível conectar ao servidor. Verifique se o backend está em execução.');
               } finally {
                    hideLoading();
               }
          });
     </script>
</body>

</html>